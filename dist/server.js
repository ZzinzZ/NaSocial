(()=>{"use strict";var e={1859:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(6037)),n=r(i(7252)),u=r(i(8900)),a=r(i(2096)),d=r(i(8577)),c=r(i(2525)),l=i(7900),f=i(4752),h=i(2320),p=i(9896),y=i(2115);t.default=class{constructor(e){this.app=(0,n.default)(),this.port=process.env.PORT||5e3,this.production=!0,this.connectToDatabase(),this.initializeMiddleware(),this.initializeRoutes(e),this.initializeErrorMiddleware(),this.initializeSwagger()}initializeRoutes(e){e.forEach((e=>{this.app.use("/",e.router)}))}listen(){this.app.listen(this.port,(()=>{console.log(`Server is listening on port ${this.port}`)}))}initializeMiddleware(){this.production?(this.app.use((0,u.default)()),this.app.use((0,c.default)()),this.app.use((0,a.default)("combined")),this.app.use((0,d.default)({origin:"your-domain.com",credentials:!0}))):(this.app.use((0,a.default)("dev")),this.app.use((0,d.default)({origin:!0,credentials:!0}))),this.app.use(n.default.json()),this.app.use(n.default.urlencoded({extended:!0}))}initializeErrorMiddleware(){this.app.use(f.errorMiddleware)}connectToDatabase(){return o(this,void 0,void 0,(function*(){try{const e=process.env.MONGODB_URL;if(!e)return void l.Logger.error("connectionString is undefined");s.default.connect(e),l.Logger.info("Database connected ")}catch(e){l.Logger.error("Connect error: "+e)}}))}initializeSwagger(){const e=p.readFileSync("./src/swagger.yaml","utf8"),t=y.parse(e);this.app.use("/swagger",h.serve,h.setup(t))}}},7742:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e,t){super(t),this.status=e,this.message=t}}t.default=i},9105:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpException=void 0;const r=o(i(7742));t.HttpException=r.default},2920:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(829));t.default=(e,t,i)=>{const o=e.header("x-auth-token");if(!o)return t.status(401).json({message:"No token, authorization denied"});try{const t=r.default.verify(o,process.env.JWT_TOKEN_SECRET);e.user||(e.user={id:""}),e.user.id=t.id,i()}catch(e){t.status(401).json({message:"Invalid token, authorization denied"})}}},3918:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(7900);t.default=(e,t,i,r)=>{const s=e.status||500,n=e.message||"Something went wrong";o.Logger.error(`[ERROR] - Status : ${s} - Message : ${n}`),i.status(s).json({message:n})}},4752:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.authMiddleware=t.errorMiddleware=void 0;const r=o(i(2920));t.authMiddleware=r.default;const s=o(i(3918));t.errorMiddleware=s.default},5999:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(4922),r=i(7403),s=i(9105);t.default=(e,t=!1)=>(i,n,u)=>{(0,r.validate)((0,o.plainToInstance)(e,i.body),{skipMissingProperties:t}).then((e=>{if(e.length>0){const t=e.map((e=>Object.values(e.constraints))).join(", ");u(new s.HttpException(400,t))}else u()}))}},9218:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyObject=void 0,t.isEmptyObject=e=>!Object.keys(e).length},7900:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyObject=t.validateEnv=t.Logger=void 0;const r=o(i(1782));t.Logger=r.default;const s=o(i(9460));t.validateEnv=s.default;const n=i(9218);Object.defineProperty(t,"isEmptyObject",{enumerable:!0,get:function(){return n.isEmptyObject}})},1782:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(5124)),s=r.default.createLogger({transports:[new r.default.transports.Console],format:r.default.format.combine(r.default.format.colorize({all:!0}),r.default.format.simple())});t.default=s},9460:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(2991);t.default=()=>{(0,o.cleanEnv)(process.env,{NODE_ENV:(0,o.str)(),MONGODB_URL:(0,o.str)()})}},9865:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5914));t.default=class{constructor(){this.authService=new s.default,this.login=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body,o=yield this.authService.login(i);t.status(200).json(o)}catch(e){i(e)}})),this.getCurrentLoginUser=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=yield this.authService.getCurrentLoginUser(e.user.id);t.status(200).json(i)}catch(e){i(e)}}))}}},4308:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(9865)),s=i(4752),n=i(7252);t.default=class{constructor(){this.path="/api/v1/auth",this.router=(0,n.Router)(),this.authController=new r.default,this.initializeRoutes()}initializeRoutes(){this.router.post(this.path,this.authController.login),this.router.get(this.path,s.authMiddleware,this.authController.getCurrentLoginUser)}}},5914:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(9617),n=i(7900),u=i(9105),a=r(i(4729)),d=r(i(829));t.default=class{constructor(){this.userSchema=s.UserSchema}login(e){return o(this,void 0,void 0,(function*(){if((0,n.isEmptyObject)(e))throw new u.HttpException(400,"Model is empty");const t=yield this.userSchema.findOne({email:e.email});if(!t)throw new u.HttpException(409,`email ${e.email} is not exists`);if(yield a.default.compare(e.password,t.password))return this.createToken(t);throw new u.HttpException(400,"Credential is not valid")}))}getCurrentLoginUser(e){return o(this,void 0,void 0,(function*(){const t=yield this.userSchema.findById(e);if(!t)throw new u.HttpException(404,"User is not exist");return t}))}createToken(e){const t={id:e._id},i=process.env.JWT_TOKEN_SECRET;return{token:d.default.sign(t,i,{expiresIn:3600})}}}},3287:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(2652));t.default=class{constructor(){this.conversationService=new s.default,this.sendMessage=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=e.body,r=yield this.conversationService.sendMessage(i,o);t.status(200).send(r)}catch(e){i(e)}})),this.getConversations=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=yield this.conversationService.getConversations(i);t.status(200).send(o)}catch(e){i(e)}}))}}},4418:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(6037)),s=new r.default.Schema({user1:{type:r.default.Schema.Types.ObjectId,required:!0,ref:"user"},user2:{type:r.default.Schema.Types.ObjectId,required:!0,ref:"user"},messages:[{from:{type:String,required:!0},to:{type:String,required:!0},read:{type:Boolean,default:!1},text:{type:String,required:!0},showOnFrom:{type:Boolean},showOnTo:{type:Boolean},date:{type:Date,default:Date.now}}],date:{type:Date,default:Date.now},recentDate:{type:Date,default:Date.now}});t.default=r.default.model("conversation",s)},4830:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7252),s=o(i(3287)),n=i(4752),u=o(i(5999)),a=o(i(833));t.default=class{constructor(){this.path="/api/v1/conversations",this.router=(0,r.Router)(),this.conversationController=new s.default,this.initializeRoute()}initializeRoute(){this.router.post(this.path,n.authMiddleware,(0,u.default)(a.default,!0),this.conversationController.sendMessage),this.router.get(this.path,n.authMiddleware,this.conversationController.getConversations)}}},2652:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1784),s=i(9617),n=i(9105);t.default=class{sendMessage(e,t){return o(this,void 0,void 0,(function*(){if(!(yield s.UserSchema.findById(e).select("-password").exec()))throw new n.HttpException(404,"User not found");if(!(yield s.UserSchema.findById(t.to).select("-password").exec()))throw new n.HttpException(404,"No recipient was found");if(t.conversationId){const i=yield r.ConversationSchema.findById(t.conversationId).exec();if(!i)throw new n.HttpException(404,"No conversation was found");if(i.user1!==e||i.user2!==t.to&&i.user1!==t.to||i.user2!==e)throw new n.HttpException(404,"No conversation was found");return null==i||i.messages.unshift({to:t.to,text:t.text,from:e}),yield i.save(),i}{let i=yield r.ConversationSchema.findOne({$or:[{$and:[{user1:e},{user2:t.to}]},{$and:[{user1:t.to},{user2:e}]}]}).exec();return i?i.messages.unshift({to:t.to,from:e,text:t.text}):i=new r.ConversationSchema({user1:e,user2:t.to,messages:[{from:e,to:t.to,text:t.text}]}),yield i.save(),i}}))}getConversations(e){return o(this,void 0,void 0,(function*(){if(!(yield s.UserSchema.findById(e).select("-password").exec()))throw new n.HttpException(404,"User not found!");return yield r.ConversationSchema.find({$or:[{user1:e},{user2:e}]}).sort({recentDate:-1})}))}}},833:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7403);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"to",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"text",void 0)},1784:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationSchema=void 0;const r=o(i(4418));t.ConversationSchema=r.default},4521:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7403);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"name",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"code",void 0)},6681:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7403);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"userId",void 0)},9163:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(2488));t.default=class{constructor(){this.groupService=new s.default,this.createGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=e.body,r=yield this.groupService.createGroup(i,o);t.status(201).json(r)}catch(e){i(e)}})),this.getAllGroups=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const e=yield this.groupService.getAllGroups();t.status(200).json(e)}catch(e){i(e)}})),this.updateGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.body,r=yield this.groupService.updateGroup(i,o);t.status(202).json(r)}catch(e){i(e)}})),this.deleteGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id;yield this.groupService.deleteGroup(i),t.status(200).json("Delete successfully!")}catch(e){i(e)}})),this.requestJoinGroup=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.user.id,r=yield this.groupService.requestJoinGroup(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.acceptJoinRequest=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.params.user_id,r=yield this.groupService.acceptJoinRequest(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.setManager=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.body,r=yield this.groupService.setManager(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.removeManager=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.params.user_id,r=yield this.groupService.removeManager(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.getAllGroupMembers=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=yield this.groupService.getAllGroupMembers(i);t.status(200).json(o)}catch(e){i(e)}})),this.removeMember=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.params.user_id,r=yield this.groupService.removeMember(i,o);t.status(200).json(r)}catch(e){i(e)}}))}}},5550:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(6037)),s=new r.default.Schema({creator:{type:r.default.Schema.Types.ObjectId,ref:"user"},name:{type:String,required:!0},code:{type:String,required:!0},description:{type:String},members:[{user:{type:r.default.Schema.Types.ObjectId,ref:"user"},join_date:{type:Date,default:Date.now}}],member_requests:[{user:{type:r.default.Schema.Types.ObjectId,ref:"user"},date:{type:Date,default:Date.now}}],manager:[{user:{type:r.default.Schema.Types.ObjectId,ref:"user"},role:{type:String,enum:["admin","mod"],default:"admin"}}],date:{type:Date,default:Date.now}});t.default=r.default.model("group",s)},354:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7252),s=o(i(9163)),n=i(4752),u=o(i(5999)),a=o(i(4521)),d=o(i(6681));t.default=class{constructor(){this.path="/api/v1/groups",this.router=(0,r.Router)(),this.groupController=new s.default,this.initializeRoute()}initializeRoute(){this.router.post(this.path,n.authMiddleware,(0,u.default)(a.default,!0),this.groupController.createGroup),this.router.get(this.path,this.groupController.getAllGroups),this.router.put(this.path+"/:id",n.authMiddleware,(0,u.default)(a.default,!0),this.groupController.updateGroup),this.router.delete(this.path+"/:id",n.authMiddleware,this.groupController.deleteGroup),this.router.post(this.path+"/members/join/:id",n.authMiddleware,this.groupController.requestJoinGroup),this.router.put(this.path+"/members/:id/:user_id",n.authMiddleware,this.groupController.acceptJoinRequest),this.router.post(this.path+"/managers/:id",n.authMiddleware,(0,u.default)(d.default,!0),this.groupController.setManager),this.router.delete(this.path+"/managers/:id/:user_id",n.authMiddleware,this.groupController.removeManager),this.router.get(this.path+"/members/:id/",this.groupController.getAllGroupMembers),this.router.delete(this.path+"/members/:id/:user_id",n.authMiddleware,this.groupController.removeMember)}}},2488:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(9105),s=i(9617),n=i(5878);t.default=class{createGroup(e,t){return o(this,void 0,void 0,(function*(){if(!(yield s.UserSchema.findById(e)))throw new r.HttpException(404,"User not found");const i=yield n.GroupSchema.find({code:t.code});if(i&&i.length>0)throw new r.HttpException(400,"Group already exists");const o=new n.GroupSchema(Object.assign({},t));return yield o.save()}))}getAllGroups(){return o(this,void 0,void 0,(function*(){return yield n.GroupSchema.find().exec()}))}updateGroup(e,t){return o(this,void 0,void 0,(function*(){if(!(yield n.GroupSchema.findById(e).exec()))throw new r.HttpException(404,"Group not found");const i=Object.assign({},t);if((yield n.GroupSchema.find({$and:[{$or:[{name:t.name},{code:t.code}]},{_id:{$ne:e}}]}).exec()).length>0)throw new r.HttpException(400,"Group already exists");const o=yield n.GroupSchema.findOneAndUpdate({_id:e},{$set:i},{new:!0});if(!o)throw new r.HttpException(400,"Update failed!");return o}))}deleteGroup(e){return o(this,void 0,void 0,(function*(){if(!(yield n.GroupSchema.findById(e).exec()))throw new r.HttpException(404,"Group not found");const t=yield n.GroupSchema.findByIdAndDelete(e).exec();if(!t)throw new r.HttpException(400,"Delete failed!");return t}))}requestJoinGroup(e,t){return o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(t).exec();if(!i)throw new r.HttpException(404,"Group not found");if(!(yield s.UserSchema.findById(e).select("-password").exec()))throw new r.HttpException(404,"User not found");if(i.member_requests&&i.member_requests.some((t=>t.user.toString()===e)))throw new r.HttpException(400,"You have requested to join this group");if(i.members&&i.members.some((t=>t.user.toString()===e)))throw new r.HttpException(400,"You are already a member of this group");return i.member_requests.unshift({user:e}),yield i.save(),i}))}acceptJoinRequest(e,t){return o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(t).exec();if(!i)throw new r.HttpException(404,"Group not found");if(!(yield s.UserSchema.findById(e).select("-password").exec()))throw new r.HttpException(404,"User not found");if(i.member_requests&&i.member_requests.some((t=>t.user.toString()!==e)))throw new r.HttpException(400,"There are no requests from this user");return i.member_requests=i.member_requests.filter((t=>t.user.toString()!==e)),i.members.unshift({user:e}),yield i.save(),i}))}setManager(e,t){return o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(t).exec();if(!i)throw new r.HttpException(404,"Group not found");if(!(yield s.UserSchema.findById(e.userId).select("-password").exec()))throw new r.HttpException(404,"User not found");if(i.members&&i.members.some((t=>t.user.toString()!==e.userId)))throw new r.HttpException(400,"This user is not a member of this group");if(i.manager&&i.manager.some((t=>t.user.toString()===e.userId)))throw new r.HttpException(400,"You have been set to be manager this group");return i.manager.unshift({user:e.userId,role:e.role}),yield i.save(),i}))}removeManager(e,t){return o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(t).exec();if(!i)throw new r.HttpException(404,"Group not found");if(!(yield s.UserSchema.findById(e).select("-password").exec()))throw new r.HttpException(404,"User not found");if(i.manager&&i.manager.some((t=>t.user.toString()!==e)))throw new r.HttpException(400,"This user is not an manager of this group");return i.manager=i.manager.filter((t=>t.user.toString()!==e)),yield i.save(),i}))}getAllGroupMembers(e){return o(this,void 0,void 0,(function*(){const t=yield n.GroupSchema.findById(e).exec();if(!t)throw new r.HttpException(404,"Group not found");const i=yield t.members.map((e=>e.user));return yield s.UserSchema.find({_id:i}).select("-password").exec()}))}removeMember(e,t){return o(this,void 0,void 0,(function*(){const i=yield n.GroupSchema.findById(e).exec();if(!i)throw new r.HttpException(404,"Group not found");if(!(yield s.UserSchema.findById(t).select("-password").exec()))throw new r.HttpException(404,"User not found");if(i.members&&i.members.some((e=>{e.user.toString()})))throw new r.HttpException(400,"This user is not a member of this group");if(1==i.members.length)throw new r.HttpException(400,"You are the only member of this group");return i.members=i.members.filter((e=>e.user.toString()!==t)),yield i.save(),i}))}}},5878:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GroupSchema=void 0;const r=o(i(5550));t.GroupSchema=r.default},3603:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.index=(e,t,i)=>{try{t.status(200).send("Api is available")}catch(e){i(e)}}}}},5178:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7252),s=o(i(3603));t.default=class{constructor(){this.path="/",this.router=(0,r.Router)(),this.indexController=new s.default,this.initializeRoutes()}initializeRoutes(){this.router.get(this.path,this.indexController.index)}}},6441:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IndexRoute=t.IndexController=void 0;const r=o(i(3603));t.IndexController=r.default;const s=o(i(5178));t.IndexRoute=s.default},7660:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7403);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"text",void 0)},3893:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7403);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"text",void 0)},2150:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostSchema=void 0;const r=o(i(6557));t.PostSchema=r.default},5834:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(2619));t.default=class{constructor(){this.postService=new s.default,this.createPost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body,o=e.user.id,r=yield this.postService.createPost(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.updatePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body,o=e.params.id,r=yield this.postService.updatePost(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.getAllPost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const e=yield this.postService.getAllPosts();t.status(200).json(e)}catch(e){i(e)}})),this.getPostById=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=yield this.postService.getById(i);t.status(200).json(o)}catch(e){i(e)}})),this.getAllPostPaging=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=Number(e.params.page),o=e.query.keyword||"",r=yield this.postService.getAllPostsPaging(o.toString(),i);t.status(200).json(r)}catch(e){i(e)}})),this.deletePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.user.id;yield this.postService.deletePost(o,i),t.status(200).json({message:"delete post successfully"})}catch(e){i(e)}})),this.likePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.user.id,r=yield this.postService.likePost(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.unLikePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.user.id,r=yield this.postService.unLikePost(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.createComment=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body.text,o=e.user.id,r=e.params.id,s=yield this.postService.createComment({text:i,userId:o,postId:r});t.status(200).json(s)}catch(e){i(e)}})),this.removeComment=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.comment_id,o=e.user.id,r=e.params.id,s=yield this.postService.removeComment(i,r,o);t.status(200).json(s)}catch(e){i(e)}})),this.sharePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.user.id,r=yield this.postService.sharePost(o,i);t.status(200).json(r)}catch(e){i(e)}})),this.unSharePost=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.user.id,r=yield this.postService.unSharePost(o,i);t.status(200).json(r)}catch(e){i(e)}}))}}},6557:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(6037)),s=new r.default.Schema({user:{type:r.default.Schema.Types.ObjectId,ref:"user"},text:{type:String,required:!0},avatar:{type:String},likes:[{user:{type:r.default.Schema.Types.ObjectId}}],comments:[{user:{type:r.default.Schema.Types.ObjectId},text:{type:String,required:!0},name:{type:String},avatar:{type:String},date:{type:Date,default:Date.now}}],shares:[{user:{type:r.default.Schema.Types.ObjectId}}],date:{type:Date,default:Date.now}});t.default=r.default.model("post",s)},5:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(5834)),s=o(i(5999)),n=i(7252),u=o(i(3893)),a=i(4752),d=o(i(7660));t.default=class{constructor(){this.path="/api/v1/posts",this.router=(0,n.Router)(),this.postController=new r.default,this.initializeRoute()}initializeRoute(){this.router.post(this.path,a.authMiddleware,(0,s.default)(u.default,!0),this.postController.createPost),this.router.put(this.path+"/:id",a.authMiddleware,(0,s.default)(u.default,!0),this.postController.updatePost),this.router.get(this.path,this.postController.getAllPost),this.router.get(this.path+"/:postId",this.postController.getPostById),this.router.get(this.path+"/paging/:page",this.postController.getAllPostPaging),this.router.delete(this.path+"/:id",a.authMiddleware,this.postController.deletePost),this.router.post(this.path+"/like/:id",a.authMiddleware,this.postController.likePost),this.router.delete(this.path+"/like/:id",a.authMiddleware,this.postController.unLikePost),this.router.post(this.path+"/comments/:id",a.authMiddleware,(0,s.default)(d.default,!0),this.postController.createComment),this.router.delete(this.path+"/comments/:id/:comment_id",a.authMiddleware,this.postController.removeComment),this.router.post(this.path+"/shares/:id",a.authMiddleware,this.postController.sharePost),this.router.delete(this.path+"/shares/:id",a.authMiddleware,this.postController.unSharePost)}}},2619:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(9617),s=i(2150),n=i(9105);t.default=class{createPost(e,t){return o(this,void 0,void 0,(function*(){const i=yield r.UserSchema.findById(e).select("-password").exec();if(!i)throw new n.HttpException(400,"User is not exist");const o=new s.PostSchema({text:t.text,name:i.first_name+" "+i.last_name,avatar:i.avatar,user:e});return yield o.save()}))}updatePost(e,t){return o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findByIdAndUpdate(e,Object.assign({},t),{new:!0}).exec();if(!i)throw new n.HttpException(404,"Post is not found");return i}))}getAllPosts(){return o(this,void 0,void 0,(function*(){return yield s.PostSchema.find().exec()}))}getById(e){return o(this,void 0,void 0,(function*(){const t=yield s.PostSchema.findById(e).exec();if(!t)throw new n.HttpException(404,"Post not found");return t}))}getAllPostsPaging(e,t){return o(this,void 0,void 0,(function*(){const i=Number(process.env.PAGE_SIZE)||10;let o={};e&&(o={$or:[{text:e}]});const r=yield s.PostSchema.find(o).skip((t-1)*i).limit(i).exec();return{total:yield s.PostSchema.find(o).countDocuments().exec(),page:t,pageSize:i,items:r}}))}deletePost(e,t){return o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findByIdAndDelete(t).exec();if(!i)throw new n.HttpException(404,"Post not found");if(i.user.toString()!==e)throw new n.HttpException(400,"User is not authorized")}))}likePost(e,t){return o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findById(t).exec();if(!i)throw new n.HttpException(404,"Post not found");if(i.likes.some((t=>t.user.toString()===e)))throw new n.HttpException(400,"Post already liked");return i.likes.unshift({user:e}),yield i.save(),i.likes}))}unLikePost(e,t){return o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findById(t).exec();if(!i)throw new n.HttpException(404,"Post not found");if(!i.likes.some((t=>t.user.toString()===e)))throw new n.HttpException(400,"The post has not been liked yet");return i.likes=i.likes.filter((({user:t})=>t.toString()!==e)),yield i.save(),i.likes}))}createComment(e){return o(this,void 0,void 0,(function*(){const t=yield s.PostSchema.findById(e.postId).exec();if(!t)throw new n.HttpException(404,"Post not found");const i=yield r.UserSchema.findById(e.userId).select("-password").exec();if(!i)throw new n.HttpException(404,"User not found");const o={text:e.text,name:i.first_name+" "+i.last_name,avatar:i.avatar,user:e.userId};return t.comments.unshift(o),t.save(),t.comments}))}removeComment(e,t,i){return o(this,void 0,void 0,(function*(){const o=yield s.PostSchema.findById(t).exec();if(!o)throw new n.HttpException(404,"Post not found");const r=o.comments.find((t=>t._id.toString()===e));if(!r)throw new n.HttpException(404,"Comment not found");if(r.user.toString()!==i)throw new n.HttpException(401,"User is not authorized");return o.comments=o.comments.filter((({_id:t})=>t.toString()!==e)),o.save(),o.comments}))}sharePost(e,t){return o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findById(t).exec();if(!i)throw new n.HttpException(404,"Post not found");if(i.shares&&i.shares.some((t=>t.user.toString()===e)))throw new n.HttpException(400,"Post already shared");return i.shares.unshift({user:e}),yield i.save(),i.shares}))}unSharePost(e,t){return o(this,void 0,void 0,(function*(){const i=yield s.PostSchema.findById(t).exec();if(!i)throw new n.HttpException(404,"Post not found");if(i.shares&&!i.shares.some((t=>t.user.toString()===e)))throw new n.HttpException(400,"The post has not been shared yet");return i.shares||(i.shares=[]),i.shares=i.shares.filter((({user:t})=>t.toString()!==e)),yield i.save(),i.shares}))}}},363:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7403);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"school",void 0)},7727:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7403);class s{}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"title",void 0)},6797:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7403);class s{constructor(e,t,i,o,r,s,n,u,a,d,c){this.company=e,this.location=t,this.website=i,this.bio=o,this.skills=r,this.status=s,this.youtube=n,this.twitter=u,this.facebook=a,this.instagram=d,this.linkedin=c}}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"company",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"location",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"website",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"bio",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"skills",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"status",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"youtube",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"twitter",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"facebook",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"instagram",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"linkedin",void 0)},1199:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(628));t.default=class{constructor(){this.profileService=new s.default,this.getCurrentProfile=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.user.id,o=yield this.profileService.getCurrentProfile(i);t.status(200).json(o)}catch(e){i(e)}})),this.getProfileByID=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=yield this.profileService.getCurrentProfile(i);t.status(200).json({data:o,message:"Updated"})}catch(e){i(e)}})),this.getAllProfiles=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const e=yield this.profileService.getAllProfiles();t.status(200).json(e)}catch(e){i(e)}})),this.createProfile=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.body,r=e.user.id;try{const e=yield this.profileService.createProfile(r,o);t.status(201).json({data:e})}catch(e){i(e)}})),this.deleteProfile=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id;try{yield this.profileService.deleteProfile(o),t.status(200)}catch(e){i(e)}})),this.addExperience=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.body,r=e.user.id;try{const e=yield this.profileService.addExperience(r,o);t.status(201).json(e)}catch(e){i(e)}})),this.deleteProfileExperience=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.exp_id;try{const i=yield this.profileService.deleteProfileExperience(e.user.id,o);t.status(200).json(i)}catch(e){i(e)}})),this.addEducation=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.body,r=e.user.id;try{const e=yield this.profileService.addEducation(r,o);t.status(201).json(e)}catch(e){i(e)}})),this.deleteProfileEducation=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.exp_id;try{const i=yield this.profileService.deleteProfileEducation(e.user.id,o);t.status(200).json(i)}catch(e){i(e)}})),this.follow=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id;try{const i=yield this.profileService.follow(e.user.id,o);t.status(200).json(i)}catch(e){i(e)}})),this.unFollow=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id;try{const i=yield this.profileService.unFollow(e.user.id,o);t.status(200).json(i)}catch(e){i(e)}})),this.addFriend=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id;try{const i=yield this.profileService.addFriend(e.user.id,o);t.status(200).json(i)}catch(e){i(e)}})),this.unFriend=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.params.id;try{const i=yield this.profileService.unFriend(e.user.id,o);t.status(200).json(i)}catch(e){i(e)}})),this.acceptFriendRequest=(e,t,i)=>o(this,void 0,void 0,(function*(){const o=e.user.id,r=e.params.id;try{const e=yield this.profileService.acceptFriendRequest(o,r);t.status(200).json(e)}catch(e){i(e)}}))}}},3338:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(6037)),s=new r.default.Schema({user:{type:r.default.Schema.Types.ObjectId,ref:"user"},company:{type:String},website:{type:String},location:{type:String},status:{type:String,required:!0},skills:{type:[String],required:!0},bio:{type:String},experience:[{title:{type:String,required:!0},company:{type:String,required:!0},location:{type:String},from:{type:Date,required:!0},to:{type:Date},current:{type:Boolean,default:!1},description:{type:String}}],education:[{school:{type:String,required:!0},degree:{type:String,required:!0},fieldOfStudy:{type:String,required:!0},from:{type:Date,required:!0},to:{type:Date},current:{type:Boolean,default:!1},description:{type:String}}],followings:[{user:{type:r.default.Schema.Types.ObjectId,ref:"user"}}],followers:[{user:{type:r.default.Schema.Types.ObjectId,ref:"user"}}],friends:[{user:{type:r.default.Schema.Types.ObjectId,ref:"user"},date:{type:Date,default:Date.now}}],friend_requests:[{user:{type:r.default.Schema.Types.ObjectId,ref:"user"},date:{type:Date,default:Date.now}}],social:{youtube:{type:String},twitter:{type:String},facebook:{type:String},instagram:{type:String},linkedin:{type:String}},date:{type:Date,default:Date.now}});t.default=r.default.model("profile",s)},326:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7252),s=o(i(1199)),n=i(4752),u=o(i(5999)),a=o(i(6797)),d=o(i(7727)),c=o(i(363));t.default=class{constructor(){this.path="/api/v1/profile",this.router=(0,r.Router)(),this.profileController=new s.default,this.initializeRoute()}initializeRoute(){this.router.get(`${this.path}`,this.profileController.getAllProfiles),this.router.get(`${this.path}/user/:id`,this.profileController.getProfileByID),this.router.get(`${this.path}/me`,n.authMiddleware,this.profileController.getCurrentProfile),this.router.post(`${this.path}`,n.authMiddleware,(0,u.default)(a.default),this.profileController.createProfile),this.router.delete(`${this.path}/:id`,n.authMiddleware,this.profileController.deleteProfile),this.router.put(`${this.path}/experience`,n.authMiddleware,(0,u.default)(d.default),this.profileController.addExperience),this.router.put(`${this.path}/experience/:exp_id`,n.authMiddleware,this.profileController.deleteProfileExperience),this.router.put(`${this.path}/education`,n.authMiddleware,(0,u.default)(c.default),this.profileController.addEducation),this.router.post(`${this.path}/following/:id`,n.authMiddleware,this.profileController.follow),this.router.delete(`${this.path}/following/:id`,n.authMiddleware,this.profileController.unFollow),this.router.post(`${this.path}/friends/:id`,n.authMiddleware,this.profileController.addFriend),this.router.delete(`${this.path}/friends/:id`,n.authMiddleware,this.profileController.unFriend),this.router.put(`${this.path}/friends/:id`,n.authMiddleware,this.profileController.acceptFriendRequest)}}},628:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(3338)),n=i(9105),u=r(i(5047)),a=i(9617);t.default=class{constructor(){this.addExperience=(e,t)=>o(this,void 0,void 0,(function*(){const i=Object.assign({},t),o=yield s.default.findOne({user:e}).exec();if(!o)throw new n.HttpException(400,"There is not profile for this user");return o.experience.unshift(i),yield o.save(),o})),this.deleteProfileExperience=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.default.findOne({user:e}).exec();if(!i)throw new n.HttpException(400,"There is not profile for this user");return i.experience=i.experience.filter((e=>e._id.toString()!==t)),yield i.save(),i})),this.addEducation=(e,t)=>o(this,void 0,void 0,(function*(){const i=Object.assign({},t),o=yield s.default.findOne({user:e}).exec();if(!o)throw new n.HttpException(400,"There is not profile for this user");return o.education.unshift(i),yield o.save(),o})),this.deleteProfileEducation=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.default.findOne({user:e}).exec();if(!i)throw new n.HttpException(400,"There is not profile for this user");return i.education=i.education.filter((e=>e._id.toString()!==t)),yield i.save(),i})),this.follow=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.default.findOne({user:e}).exec();if(!i)throw new n.HttpException(400,"There is not profile for this user");if(i.followings&&i.followings.some((t=>t.user.toString()===e)))throw new n.HttpException(400,"You has been already followed this user");const o=yield s.default.findOne({user:t}).exec();if(!o)throw new n.HttpException(400,"There is not profile for this user");if(i.followers&&i.followers.some((e=>e.user.toString()===t)))throw new n.HttpException(400,"You have been followed by this user");return i.followings.unshift({user:t}),o.followers.unshift({user:e}),i.followings||(i.followings=[]),yield i.save(),o.followers||(o.followers=[]),yield o.save(),i})),this.unFollow=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.default.findOne({user:e}).exec();if(!i)throw new n.HttpException(400,"There is no profile for this user");if(!i.followings.some((e=>e.user.toString()===t)))throw new n.HttpException(400,"You are not following this user");const o=yield s.default.findOne({user:t}).exec();if(!o)throw new n.HttpException(400,"There is no profile for the user being followed");return i.followings=i.followings.filter((e=>e.user.toString()!==t)),o.followers=o.followers.filter((t=>t.user.toString()!==e)),yield i.save(),yield o.save(),i})),this.addFriend=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.default.findOne({user:e}).exec();if(!i)throw new n.HttpException(400,"There is not profile for this user");if(i.friend_requests&&i.friend_requests.some((t=>t.user.toString()===e)))throw new n.HttpException(400,"You has been already request to this user");const o=yield s.default.findOne({user:t}).exec();if(!o)throw new n.HttpException(400,"There is not profile for this user");if(o.friends&&o.friends.some((e=>e.user.toString()===t)))throw new n.HttpException(400,"You have been added friend by this user");return o.friend_requests||(o.friend_requests=[]),o.friend_requests.unshift({user:e}),yield o.save(),o})),this.unFriend=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.default.findOne({user:e}).exec();if(!i)throw new n.HttpException(400,"There is not profile for this user");if(i.friend_requests&&i.friend_requests.some((t=>t.user.toString()===e)))throw new n.HttpException(400,"You has been already request to this user");const o=yield s.default.findOne({user:t}).exec();if(!o)throw new n.HttpException(400,"There is not profile for this user");if(o.friends&&o.friends.some((e=>e.user.toString()===t)))throw new n.HttpException(400,"You have been added friend by this user");return i.friend_requests||(i.friend_requests=[]),i.friend_requests.filter((({user:e})=>e.toString()!==t)),o.friends||(o.friends=[]),o.friends.filter((({user:t})=>t.toString()!==e)),yield o.save(),yield i.save(),i})),this.acceptFriendRequest=(e,t)=>o(this,void 0,void 0,(function*(){const i=yield s.default.findOne({user:e}).exec();if(!i)throw new n.HttpException(400,"There is not profile for this user");if(i.friends&&i.friends.some((e=>e.user.toString()!==t)))throw new n.HttpException(400,"You has not any friend request related to this user");const o=yield s.default.findOne({user:t}).exec();if(!o)throw new n.HttpException(400,"There is not profile for this user");if(o.friends&&o.friends.some((t=>t.user.toString()===e)))throw new n.HttpException(400,"You has already be friends with this user");return i.friend_requests||(i.friend_requests=[]),i.friend_requests=i.friend_requests.filter((({user:e})=>e.toString()!==t)),i.friends||(i.friends=[]),i.friends.unshift({user:t}),o.friends||(o.friends=[]),o.friends.unshift({user:e}),yield i.save(),yield o.save(),i}))}getCurrentProfile(e){return o(this,void 0,void 0,(function*(){const t=yield s.default.findOne({user:e}).populate("user",["name","avatar"]).exec();if(!t)throw new n.HttpException(400,"There is no profile found");return t}))}createProfile(e,t){return o(this,void 0,void 0,(function*(){const{company:i,location:o,website:r,bio:n,skills:a,status:d,youtube:c,twitter:l,facebook:f,instagram:h,linkedin:p}=t,y={user:e,company:i,location:o,website:r&&""!=r?(0,u.default)(r.toString(),{forceHttps:!0}):"",bio:n,skills:Array.isArray(a)?a:a.split(",").map((e=>" "+e.trim())),status:d},v={youtube:c,twitter:l,facebook:f,instagram:h,linkedin:p};for(const[e,t]of Object.entries(v))t&&t.length>0&&(v[e]=(0,u.default)(t,{forceHttps:!0}));return y.social=v,yield s.default.findOneAndUpdate({user:e},{$set:y},{new:!0,upsert:!0,setDefaultsOnInsert:!0}).exec()}))}deleteProfile(e){return o(this,void 0,void 0,(function*(){yield s.default.findOneAndDelete({user:e}).exec(),yield a.UserSchema.findOneAndDelete({user:e}).exec()}))}getAllProfiles(){return o(this,void 0,void 0,(function*(){return yield s.default.find().populate("user",["name","avatar"]).exec()}))}}},6196:function(e,t,i){var o=this&&this.__decorate||function(e,t,i,o){var r,s=arguments.length,n=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,o);else for(var u=e.length-1;u>=0;u--)(r=e[u])&&(n=(s<3?r(n):s>3?r(t,i,n):r(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7403);class s{constructor(e,t,i,o){this.first_name=e,this.last_name=t,this.email=i,this.password=o}}t.default=s,o([(0,r.IsNotEmpty)()],s.prototype,"first_name",void 0),o([(0,r.IsNotEmpty)()],s.prototype,"last_name",void 0),o([(0,r.IsNotEmpty)(),(0,r.IsEmail)()],s.prototype,"email",void 0),o([(0,r.IsNotEmpty)(),(0,r.MinLength)(8)],s.prototype,"password",void 0)},9617:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserSchema=t.UserRoute=void 0;const r=o(i(4553));t.UserRoute=r.default;const s=o(i(4121));t.UserSchema=s.default},1854:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(6087));t.default=class{constructor(){this.userService=new s.default,this.register=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.body,o=yield this.userService.createUser(i);t.status(201).json(o)}catch(e){i(e)}})),this.getUserById=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=yield this.userService.getUserById(i);t.status(200).json(o)}catch(e){i(e)}})),this.updateUser=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=e.params.id,o=e.body,r=yield this.userService.updateUser(i,o);t.status(200).json(r)}catch(e){i(e)}})),this.getAllUsers=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const e=yield this.userService.getAllUser();t.status(200).json(e)}catch(e){i(e)}})),this.getAllPaging=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=Number(e.params.page),o=e.query.keyword||"",r=yield this.userService.getAllPaging(o.toString(),i);t.status(200).json(r)}catch(e){i(e)}})),this.deleteUser=(e,t,i)=>o(this,void 0,void 0,(function*(){try{const i=yield this.userService.deleteUser(e.params.id);t.status(200).json(i)}catch(e){i()}}))}}},4121:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(6037)),s=new r.default.Schema({first_name:{type:String,required:!0},last_name:{type:String,required:!0},email:{type:String,index:!0,unique:!0,required:!0},password:{type:String,required:!0},avatar:{type:String},date:{type:Date,default:Date.now}});t.default=r.default.model("user",s)},4553:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(i(1854)),s=o(i(5999)),n=i(7252),u=o(i(6196)),a=i(4752);t.default=class{constructor(){this.path="/api/users",this.router=(0,n.Router)(),this.userController=new r.default,this.initializeRoutes()}initializeRoutes(){this.router.post(this.path,(0,s.default)(u.default,!0),this.userController.register),this.router.get(this.path+"/:id",this.userController.getUserById),this.router.put(this.path+"/:id",(0,s.default)(u.default,!0),this.userController.updateUser),this.router.get(this.path,this.userController.getAllUsers),this.router.get(this.path+"/paging/:page",this.userController.getAllPaging),this.router.delete(this.path+"/:id",a.authMiddleware,this.userController.deleteUser)}}},6087:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(r,s){function n(e){try{a(o.next(e))}catch(e){s(e)}}function u(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,u)}a((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4121)),n=i(7900),u=i(9105),a=r(i(6452)),d=r(i(4729)),c=r(i(829));t.default=class{constructor(){this.userSchema=s.default}createUser(e){return o(this,void 0,void 0,(function*(){if((0,n.isEmptyObject)(e))throw new u.HttpException(400,"Model is empty");if(yield this.userSchema.findOne({email:e.email}))throw new u.HttpException(409,`email ${e.email} already exists`);const t=a.default.url(e.email,{size:"200",rating:"pg",default:"mm"}),i=yield d.default.genSalt(10),o=yield d.default.hash(e.password,i),r=yield this.userSchema.create(Object.assign(Object.assign({},e),{password:o,avatar:t,date:Date.now()}));return this.createToken(r)}))}updateUser(e,t){return o(this,void 0,void 0,(function*(){if((0,n.isEmptyObject)(t))throw new u.HttpException(400,"Model is empty");const i=yield this.userSchema.findById(e).exec();if(!i)throw new u.HttpException(404,"UserId is not found");let o,r=i.avatar;if(i.email===t.email)throw new u.HttpException(400,"You need to enter another email");if(0!==(yield this.userSchema.find({$and:[{email:{$eq:t.email}},{_id:{$ne:e}}]}).exec()).length)throw new u.HttpException(400,"This email has been used");if(t.password){const i=yield d.default.genSalt(10),s=yield d.default.hash(t.password,i);o=yield this.userSchema.findByIdAndUpdate(e,Object.assign(Object.assign({},t),{avatar:r,password:s}),{new:!0}).exec()}else o=yield this.userSchema.findByIdAndUpdate(e,Object.assign(Object.assign({},t),{avatar:r}),{new:!0}).exec();if(!o)throw new u.HttpException(409,"User not found!");return o}))}getUserById(e){return o(this,void 0,void 0,(function*(){const t=yield this.userSchema.findById(e);if(!t)throw new u.HttpException(404,"User is not exist");return t}))}getAllUser(){return o(this,void 0,void 0,(function*(){return yield this.userSchema.find().exec()}))}getAllPaging(e,t){return o(this,void 0,void 0,(function*(){const i=Number(process.env.PAGE_SIZE)||10;let o={};e&&(o={$or:[{email:e},{first_name:e},{last_name:e}]});const r=yield this.userSchema.find(o).skip((t-1)*i).limit(i).exec();return{total:yield this.userSchema.find(o).countDocuments(o).exec(),page:t,pageSize:i,items:r}}))}deleteUser(e){return o(this,void 0,void 0,(function*(){const t=yield this.userSchema.findByIdAndDelete(e).exec();if(!t)throw new u.HttpException(404,"User not found");return t}))}createToken(e){const t={id:e._id},i=process.env.JWT_TOKEN_SECRET;return{token:c.default.sign(t,i,{expiresIn:3600})}}}},6997:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),i(4469);const r=o(i(1859)),s=i(6441),n=i(7900),u=o(i(4553)),a=o(i(4308)),d=o(i(326)),c=o(i(5)),l=o(i(354)),f=o(i(4830));(0,n.validateEnv)();const h=[new s.IndexRoute,new u.default,new a.default,new d.default,new c.default,new l.default,new f.default];new r.default(h).listen()},4729:e=>{e.exports=require("bcryptjs")},4922:e=>{e.exports=require("class-transformer")},7403:e=>{e.exports=require("class-validator")},8577:e=>{e.exports=require("cors")},4469:e=>{e.exports=require("dotenv/config")},2991:e=>{e.exports=require("envalid")},7252:e=>{e.exports=require("express")},6452:e=>{e.exports=require("gravatar")},2525:e=>{e.exports=require("helmet")},8900:e=>{e.exports=require("hpp")},829:e=>{e.exports=require("jsonwebtoken")},6037:e=>{e.exports=require("mongoose")},2096:e=>{e.exports=require("morgan")},5047:e=>{e.exports=require("normalize-url")},2320:e=>{e.exports=require("swagger-ui-express")},5124:e=>{e.exports=require("winston")},2115:e=>{e.exports=require("yaml")},9896:e=>{e.exports=require("fs")}},t={};!function i(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,i),s.exports}(6997)})();